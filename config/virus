local Fluent = loadstring(game:HttpGet(
                              "https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet(
                                   "https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet(
                                        "https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

-- ** SERVICES & INITIALIZATION **
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Remotes = ReplicatedStorage.Remotes
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local TeleportService = game:GetService("TeleportService")
local VirtualUser = game:GetService("VirtualUser")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- ** Start:Setup
-- ** Setup:premiumUsers **
local premiumUsers = {
    ["ntbks0"] = "2026-12-31",
    ["ntbks1"] = "2026-12-31",
    ["skidrow80s2"] = "2026-12-31",
    -- ["kkuplak"] = "2026-12-31",
    ["Feitann554"] = "2026-12-31",
    ["ezzys_kyy"] = "2026-12-31",
    ["BesiSelaluDiHati"] = "2026-12-31",
    ["Kibutsuchi"] = "2026-12-31",
    ["BBoss_1809"] = "2026-12-31",
    ["Bboss_8888"] = "2026-12-31",
    ["svara_aile22"] = "2026-12-31",
    ["SHT_Vinny"] = "2026-12-31",
    ["SkyWenTu"] = "2026-12-31",
    ["xMayKi18"] = "2026-12-31",
    ["Kakaafa26"] = "2026-12-31",
    ["UrrrMinneeee"] = "2025-12-05",
    ["Duke007fat"] = "2026-02-22",
    ["Anthiefbozo"] = "2025-12-01",
    ["RiavaVodianova"] = "2025-12-01",
    ["Brengoyy00"] = "2025-12-01"
}

-- ** Setup:isPremiumUser **
local function isPremiumUser()
    local player = Players.LocalPlayer
    local username = player.Name

    -- Cek apakah user ada di list premium
    local expiryDate = premiumUsers[username]
    if not expiryDate then return false end

    -- Parse tanggal expiry
    local year, month, day = expiryDate:match("(%d+)-(%d+)-(%d+)")
    local expiryTime = os.time({
        year = tonumber(year),
        month = tonumber(month),
        day = tonumber(day),
        hour = 23,
        min = 59,
        sec = 59 -- Sampai akhir hari
    })

    local currentTime = os.time()

    -- Cek apakah masih dalam masa aktif
    if currentTime <= expiryTime then
        local daysLeft = math.floor((expiryTime - currentTime) / (24 * 60 * 60))
        return true, daysLeft, expiryDate
    else
        return false, 0, expiryDate
    end
end

-- ** Fn:devMsg
local function devMsg(msg)
    -- print(msg)
    return
end

-- ** Fn:notify
local function notify(msg)
    if not msg then return end
    return Fluent:Notify({Title = "Info!", Content = msg, Duration = 5})
end
-- ** End:Setup

local BBOSS_LOGO = "rbxassetid://110896265869160"
local CUTE_LOGO = "rbxassetid://133010835890467"
local Title = "BBOS Hub"
local folderName = "bbos-hub"

repeat task.wait(0.25) until game:IsLoaded()
getgenv().Image = BBOSS_LOGO
getgenv().ToggleUI = Enum.KeyCode.LeftControl

-- Variabel global
getgenv().FluentWindow = nil
getgenv().MobileButtonEnabled = true

-- Function untuk create mobile button
local function createMobileButton()
    if getgenv().MobileButtonCreated then return end
    getgenv().MobileButtonCreated = true

    local OpenUI = Instance.new("ScreenGui")
    local ImageButton = Instance.new("ImageButton")
    local UICorner = Instance.new("UICorner")

    OpenUI.Name = "FluentMobileButton"
    OpenUI.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    OpenUI.ResetOnSpawn = false
    OpenUI.DisplayOrder = 100

    ImageButton.Parent = OpenUI
    ImageButton.Name = "ToggleButton"
    ImageButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
    ImageButton.BackgroundTransparency = 0.3
    ImageButton.Position = UDim2.new(0.1, 0, 0.1, 0)
    ImageButton.Size = UDim2.new(0, 55, 0, 55)
    ImageButton.Image = getgenv().Image
    ImageButton.Draggable = true
    ImageButton.Transparency = 0
    ImageButton.ZIndex = 1000

    UICorner.CornerRadius = UDim.new(0, 12)
    UICorner.Parent = ImageButton

    -- Function toggle yang super simple
    local function toggleUI()
        if getgenv().FluentWindow then getgenv().FluentWindow:Minimize() end
    end

    ImageButton.MouseButton1Click:Connect(toggleUI)

    devMsg("‚úÖ Mobile Button created!")
end

local Window = Fluent:CreateWindow({
    Title = Title,
    SubTitle = "by Secret",
    TabWidth = 160,
    Size = UDim2.fromOffset(480, 300),
    Acrylic = true, -- The blur may be detectable, setting this to false disables blur entirely
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl -- Used when theres no MinimizeKeybind
})

-- ** Start:FluentTabs
local Tabs = {
    Main = Window:AddTab({Title = "Main", Icon = "home"}),
    Player = Window:AddTab({Title = "Player", Icon = "user"}),
    Farm = Window:AddTab({Title = "Farm", Icon = "swords"}),
    Teleport = Window:AddTab({Title = "Teleport", Icon = "map-pin"}),
    Server = Window:AddTab({Title = "Server", Icon = "server"}),
    EggSpin = Window:AddTab({Title = "Egg / Auto Spin", Icon = "egg"}),
    Machine = Window:AddTab({Title = "Machine", Icon = "scroll"}),
    Antique = Window:AddTab({Title = "Antique", Icon = "box"}),
    -- Webhook = Window:AddTab({Title = "Webhook", Icon = "globe"}),
    Mounts = Window:AddTab({Title = "Mounts", Icon = "car"})
}
if isPremiumUser() then
    Tabs.Premium = Window:AddTab({Title = "Premium", Icon = "crown"})
end

Tabs.Settings = Window:AddTab({Title = "Settings", Icon = "settings"})

getgenv().FluentWindow = Window
createMobileButton()
local Options = Fluent.Options

-- ** UTILITY FUNCTIONS **
local function SafeRemoteCall(remoteName, name)
    local success, result = pcall(function()
        local remote = ReplicatedStorage.Remotes[remoteName]
        if remote then return remote:FireServer(name) end
    end)

    if not success then
        warn('Remote call failed: ' .. remoteName .. ' - ' .. tostring(result))
    end

    return success, result
end

local function SafeRemoteInvoke(remoteName, name)
    local success, result = pcall(function()
        local remote = ReplicatedStorage.Remotes[remoteName]
        if remote then return remote:InvokeServer(name) end
    end)

    if not success then
        warn('Remote invoke failed: ' .. remoteName .. ' - ' .. tostring(result))
    end

    return success, result
end

local function GetCharacter()
    return LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
end

-- ** Start:Config
-- ** Config:ClaimAllRewards
local claimAllRewardsConfig = {
    mapIdData = {
        50001, 50002, 50003, 50004, 50005, 50006, 50007, 50008, 50009, 50010,
        50020, 50021, 50022, 50023, 50024, 50025, 50026, 50027, 50028, 50029,
        50030, 50031, 50032, 50033, 50034, 50035, 50036, 50037
    },
    pointIdData = {
        171001, 172001, 172002, 172003, 172004, 172005, 173001, 173002, 173003,
        173004, 173005, 174001, 174002, 174003, 174004, 174005, 174001, 174002,
        174003, 174004, 174005, 175001, 175002, 175003, 175004, 175005, 176001,
        176002, 176003, 176004, 176005, 177001, 177002, 177003, 177004, 177005,
        178001, 178002, 178003, 178004, 178005, 179001, 179002, 179003, 179004,
        179005
    }
}
-- ** Config:allMapLists
local allMapLists = {
    [1] = 50001,
    [2] = 50002,
    [3] = 50003,
    [4] = 50004,
    [5] = 50005,
    [6] = 50006,
    [7] = 50007,
    [8] = 50008,
    [9] = 50009,
    [10] = 50010,
    [11] = 50020,
    [12] = 50021,
    [13] = 50022,
    [14] = 50023,
    [15] = 50024,
    [16] = 50025,
    [17] = 50026,
    [18] = 50027,
    [19] = 50028,
    [20] = 50029,
    [21] = 50030,
    [22] = 50031,
    [23] = 50032,
    [24] = 50033,
    [25] = 50034,
    [26] = 50035,
    [27] = 50036,
    [28] = 50037
}
-- ** Config:ShadowMapMapping
local ShadowMapMapping = {
    [11] = 50020,
    [12] = 50021,
    [13] = 50022,
    [14] = 50023,
    [15] = 50024,
    [16] = 50025,
    [17] = 50026,
    [18] = 50027,
    [19] = 50028,
    [20] = 50029,
    [21] = 50030
}
-- ** Config:ShadowBossModels
local ShadowBossModels = {
    "Roger[Perfect Form]", "Roger[Perfect Form][S]", "Muzan[Perfect Form]",
    "Muzan[Perfect Form][S]", "Kurama[Susano'o Mode]",
    "Kurama[Susano'o Mode][S]", "Legia[Perfect Form]", "Legia[Perfect Form][S]",
    "Monarch of Plague[Perfect Form]", "Monarch of Plague[Perfect Form][S]"
}
-- ** Config:AlienshopData
local AlienshopData = {
    -- Mask Machine
    {
        MachineId = 400001,
        MachineName = "Mask",
        ShopId = 10080,
        Items = {
            {Name = "Makomo", Id = 410001}, {Name = "Tanjirou", Id = 410002},
            {Name = "Sabito", Id = 410003}, {Name = "Fire Man", Id = 410004},
            {Name = "Tengu", Id = 410005}, {Name = "Red Horn", Id = 410050},
            {Name = "Six-Eye Violet", Id = 410051},
            {Name = "Fox Tears", Id = 410052}
        }
    }, -- Awakening Machine
    {
        MachineId = 400002,
        MachineName = "Awakening",
        ShopId = 10083,
        Items = {
            {Name = "Yorichi", Id = 410006}, {Name = "Genya", Id = 410007},
            {Name = "Muichirou", Id = 410008}, {Name = "Giyu", Id = 410009},
            {Name = "Tanjirou", Id = 410010}, {Name = "Arc Spine", Id = 410046},
            {Name = "Insight Eye", Id = 410047},
            {Name = "Seven Flare", Id = 410048},
            {Name = "Heart Quartet", Id = 410049}
        }
    }, -- Ornament Machine (Talisman dll)
    {
        MachineId = 400003,
        MachineName = "Ornament",
        ShopId = 10096,
        Items = {
            {Name = "Wooden Box", Id = 410011}, {Name = "Hulu", Id = 410012},
            {Name = "Pochita", Id = 410013}, {Name = "BW Bears", Id = 410014},
            {Name = "Butterfly Wings", Id = 410015},
            {Name = "Wishy Star Bunny", Id = 410038},
            {Name = "Mechanical wing", Id = 410039},
            {Name = "Demon Wing", Id = 410040},
            {Name = "Prism Wing", Id = 410041},
            {Name = "Omenwing of the Void", Id = 410042}
        }
    }, -- Breath Amplification Machine
    {
        MachineId = 400004,
        MachineName = "Breath",
        ShopId = 10102,
        Items = {
            {Name = "White", Id = 410016}, {Name = "Blue", Id = 410017},
            {Name = "Purple", Id = 410018}, {Name = "Orange", Id = 410019},
            {Name = "Colorful", Id = 410020}, {Name = "Glimmer", Id = 410043},
            {Name = "Flutter", Id = 410044}, {Name = "Rush", Id = 410045}
        }
    }, -- Talisman Machine
    {
        MachineId = 400005,
        MachineName = "Talisman",
        ShopId = 10115,
        Items = {
            {Name = "Bell", Id = 410021}, {Name = "Acanthosphere", Id = 410022},
            {Name = "Lotus (Power 3k)", Id = 410023},
            {Name = "Calabash (Dmg 5k)", Id = 410024},
            {Name = "As One Wishes (Luck)", Id = 410025},
            {Name = "Magic Tome (Power 10k)", Id = 410026},
            {Name = "Imperial Jade Seal", Id = 410027},
            {Name = "Quinta (Dmg 10k)", Id = 410028}
        }
    }, -- Headdress Machine
    {
        MachineId = 400006,
        MachineName = "Headdress",
        ShopId = 10199,
        Items = {
            {Name = "Fox Ears", Id = 410029},
            {Name = "Demon Horns", Id = 410030},
            {Name = "Glowing Blue Eyes", Id = 410031},
            {Name = "Wizard Hat", Id = 410032},
            {Name = "Evil Pumpkin Head", Id = 410033},
            {Name = "Lantern Head", Id = 410034},
            {Name = "Santa Hat", Id = 410035}, {Name = "Phoenix", Id = 410036},
            {Name = "Piggy Headpiece", Id = 410037}
        }
    }, -- Elemental Blessing
    {
        MachineId = 400007,
        MachineName = "Elemental",
        ShopId = 10351,
        Items = {
            {Name = "Flame Bless", Id = 410053},
            {Name = "Aqua Grace", Id = 410054},
            {Name = "Wind Blessing", Id = 410055},
            {Name = "Earth Guard", Id = 410056},
            {Name = "Light Bless", Id = 410057},
            {Name = "Thunder Favor", Id = 410058},
            {Name = "Nature Boon", Id = 410059},
            {Name = "Stellar Bless", Id = 410060}
        }
    }
}
-- ** Config:PotionData
local PotionData = {
    Lv2 = {
        TierName = "Level 2 Potions",
        Items = {
            {Name = "Luck +2", Id = 10050, Description = "Luck Potion (+2)"},
            {
                Name = "Damage +100%",
                Id = 10051,
                Description = "Damage Potion (+100%)"
            },
            {
                Name = "Power +100%",
                Id = 10052,
                Description = "Power Potion (+100%)"
            },
            {
                Name = "Gold +100%",
                Id = 10053,
                Description = "Gold Potion (+100%)"
            }
        }
    },
    Lv3 = {
        TierName = "Level 3 Potions",
        Items = {
            {
                Name = "Damage Potion (Big)",
                Id = 10308,
                Description = "Big Damage Potion"
            },
            {
                Name = "Power Potion (Big)",
                Id = 10309,
                Description = "Big Power Potion"
            },
            {
                Name = "Gold Potion (Big)",
                Id = 10310,
                Description = "Big Gold Potion"
            },
            {
                Name = "Luck Potion (Big)",
                Id = 10307,
                Description = "Big Luck Potion"
            }
        }
    }
}

-- ** Config:OtherMapsIdData
local OtherMapsIdData = {
    Dungeon = 50016,
    Tower = 50107,
    Relic = 50900,
    Halloween = 50600
}
-- ** Config:Mounts
local MountLists = {
    Mounts1 = {
        {Id = 100001, Name = "Cloud"}, {Id = 100002, Name = "Lightning Cloud"},
        {Id = 100003, Name = "Gold Cloud"},
        {Id = 100004, Name = "Magic Skateboard"},
        {Id = 100005, Name = "Sci-Fi Skateboard"},
        {Id = 100006, Name = "Pomni"}, {Id = 100007, Name = "DogeCar"},
        {Id = 100008, Name = "MagicCarpet"},
        {Id = 100009, Name = "ElectronicFantasy"},
        {Id = 100010, Name = "FireWheel"}, {Id = 100011, Name = "WaterWheel"},
        {Id = 100012, Name = "ChristmasSleigh"},
        {Id = 100013, Name = "BananaCar"}, {Id = 100014, Name = "FlyingSwords"},
        {Id = 100015, Name = "JusticeOnslaught"},
        {Id = 100016, Name = "BrokenSky"}, {Id = 100017, Name = "Nimbus"},
        {Id = 100018, Name = "RubberDukiro"}, {Id = 100019, Name = "Batmobile"},
        {Id = 100020, Name = "TorrentOfSteel"},
        {Id = 100021, Name = "SuperDaddy"},
        {Id = 100022, Name = "FlyingSaucer"}, {Id = 100023, Name = "rocket"},
        {Id = 100024, Name = "spaceship"}, {Id = 100025, Name = "Flyingleaves"},
        {Id = 100026, Name = "plane"}, {Id = 100027, Name = "chariot"},
        {Id = 100028, Name = "DarkElves"}, {Id = 100029, Name = "Mantarays"},
        {Id = 100030, Name = "DeepSeaMonstrosity"},
        {Id = 100031, Name = "WarMachine"}
    },
    Mounts2 = {
        {Id = 100032, Name = "hamburger"}, {Id = 100033, Name = "dragon"},
        {Id = 100034, Name = "Sharkplanes"},
        {Id = 100035, Name = "Swimmingrings"},
        {Id = 100036, Name = "CrocSpotters"},
        {Id = 100037, Name = "flyingfish"}, {Id = 100038, Name = "tank"},
        {Id = 100039, Name = "RoboCop"}, {Id = 100040, Name = "SpeedSnail"},
        {Id = 100041, Name = "TaiChiPanda"}, {Id = 100042, Name = "Starfleet"},
        {Id = 100043, Name = "JinDouYun"}, {Id = 100044, Name = "Fruitcarts"},
        {Id = 100045, Name = "Frigate"}, {Id = 100046, Name = "Pumpkincarts"},
        {Id = 100047, Name = "BattleTrain"}, {Id = 100048, Name = "DreamyEra"},
        {Id = 100049, Name = "AE86"}, {Id = 100050, Name = "Hovercraft"},
        {Id = 100051, Name = "BlueFlash"},
        {Id = 100052, Name = "DreamyLightWheel"},
        {Id = 100053, Name = "ChristmasPresent"},
        {Id = 100054, Name = "AirboatMissile"}, {Id = 100055, Name = "Aircar"},
        {Id = 100056, Name = "Ravager"}, {Id = 100057, Name = "Dragon"},
        {Id = 100058, Name = "Eggcart"}, {Id = 100059, Name = "Unicorn"},
        {Id = 100060, Name = "CapibarelloCocosini"},
        {Id = 100061, Name = "Rainbow popsicle"},
        {Id = 100062, Name = "LittleBee"}, {Id = 100063, Name = "BigToothCar"}
    }
}
-- ** End:Config

-- ** Start:Fn
-- ** Fn:Server
-- ** Server:GetActiveServers
local function GetActiveServers(placeId)
    placeId = placeId or game.PlaceId

    local servers = {}
    local success, result = pcall(function()
        local HttpService = game:GetService("HttpService")
        return HttpService:JSONDecode(game:HttpGet(
                                          "https://games.roblox.com/v1/games/" ..
                                              placeId ..
                                              "/servers/Public?limit=100"))
    end)

    if success and result.data then
        for _, server in ipairs(result.data) do
            if server.playing > 0 and server.playing < server.maxPlayers then
                table.insert(servers, {
                    id = server.id,
                    players = server.playing,
                    maxPlayers = server.maxPlayers,
                    ping = server.ping or 0
                })
            end
        end
    end

    -- ** Urutkan dari yang paling sepi **
    table.sort(servers, function(a, b) return a.players < b.players end)

    return servers
end

-- ** Server:activeServers
local activeServers = GetActiveServers()

-- ** Server:Config
local serverOptions = {}
local serverIdMap = {}

for i, server in ipairs(activeServers) do
    local playerStatus = ""
    -- if server.players >= 2 and server.players <= 3 then
    --     playerStatus = "‚≠ê "
    -- elseif server.players == 1 then
    --     playerStatus = "üü¢ "
    -- elseif server.players <= 5 then
    --     playerStatus = "üü° "
    -- else
    --     playerStatus = "üî¥ "
    -- end

    -- Hanya tampilkan player count, tanpa ID
    local optionText = string.format("%s%d/%d Players", playerStatus,
                                     server.players, server.maxPlayers)
    -- local optionText = playerStatus .. " Players"
    table.insert(serverOptions, optionText)
    serverIdMap[optionText] = server.id
end

-- ** Server:Default **
if #serverOptions == 0 then table.insert(serverOptions, "No servers found") end

local PreviousSelection = serverOptions[1]

local twoThreeCount = 0
for i, server in ipairs(activeServers) do
    if server.players >= 2 and server.players <= 3 then
        twoThreeCount = twoThreeCount + 1
    end
end
-- ** Fn:turnOffOtherToggles
local function turnOffOtherToggles(currentToggle)
    local otherToggles = {
        "ToggleAutoDungeon", "ToggleAutoTower", "ToggleAutoRelic",
        "ToggleAutoShadow", "ToggleAutoShadowAndDungeon",
        "ToggleAutoShadowRaidAndDungeon",
        "ToggleAutoShadowDungeonCityRaidAndOctopus",
        "ToggleAutoShadowCityRaidAndOctopus"
    }

    for _, toggleName in ipairs(otherToggles) do
        if toggleName ~= currentToggle and Options[toggleName] then
            Options[toggleName]:SetValue(false)
        end
    end
end
-- ** Fn:instantKillAllEnemies
local function instantKillAllEnemies(Enemys)
    local killedCount = 0
    local totalProcessed = 0

    for _, obj in pairs(Enemys:GetChildren()) do
        if not Options.ToggleSuperkill.Value then break end

        if obj:IsA("Model") then
            local enemyGuid = obj:GetAttribute("EnemyGuid")
            if enemyGuid then
                spawn(function()
                    SafeRemoteInvoke("ClickEnemy", {
                        ["enemyGuid"] = enemyGuid,
                        ["enemyPos"] = obj:GetPivot().Position
                    })
                    -- SafeRemoteCall("PlayerClickAttack", {
                    --     ["attackEnemyGUID"] = enemyGuid
                    -- })
                end)
                killedCount = killedCount + 1
                task.wait(0.08) -- Delay sangat cepat
            end
            totalProcessed = totalProcessed + 1
        end
    end
    devMsg("üíÄ Instant Killed " .. killedCount .. " enemies (scanned " ..
               totalProcessed .. " objects)")
end
-- ** Fn:TeleportToMap
local function TeleportToMap(mapNumber)
    local mapId = ShadowMapMapping[mapNumber]
    if not mapId then
        devMsg("Invalid map number: " .. tostring(mapNumber))
        return false
    end

    devMsg("üöÄ Teleporting to Map " .. mapNumber .. " (ID: " .. mapId .. ")")

    SafeRemoteCall("LocalPlayerTeleport", {["mapId"] = mapId})
    task.wait(1)

    return true
end
-- ** Fn:CheckCurrentMapForShadowBoss
local function CheckCurrentMapForShadowBoss()
    local workspace = game:GetService("Workspace")
    -- Cek di Enemys folder dulu (lebih efisien)
    local Enemys = workspace:FindFirstChild("Enemys")
    if Enemys then
        for _, obj in pairs(Enemys:GetChildren()) do
            if obj:IsA("Model") then
                for _, modelName in ipairs(ShadowBossModels) do
                    if obj.Name == modelName then
                        local humanoidRootPart = obj:FindFirstChild(
                                                     "HumanoidRootPart")
                        if humanoidRootPart then
                            devMsg("üéØ Found Shadow Boss in Enemys: " ..
                                       obj.Name)
                            return {
                                Model = obj,
                                Name = obj.Name,
                                Position = humanoidRootPart.Position
                            }
                        end
                    end
                end
            end
        end
    end
    return nil
end
-- ** Fn:TeleportToShadowBoss
local function TeleportToShadowBoss(shadowBoss)
    -- local player = Players.LocalPlayer
    -- local character = player.Character
    -- if not character then return false end

    -- local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    -- if not humanoidRootPart then return false end

    -- local direction = (humanoidRootPart.Position - shadowBoss.Position).Unit
    -- local targetPosition = humanoidRootPart.Position - (direction * 4) -- 4 stud dari player
    -- targetPosition = Vector3.new(targetPosition.X, humanoidRootPart.Position.Y,
    --                              targetPosition.Z)

    -- humanoidRootPart.CFrame = CFrame.new(targetPosition)
    -- return true

    -- local player = Players.LocalPlayer
    local character = GetCharacter()
    if not character then return false end

    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return false end

    -- Dapetin model Shadow Boss dari return table
    local bossModel = shadowBoss.Model
    local bossPrimaryPart = bossModel:FindFirstChild("HumanoidRootPart")
    if not bossPrimaryPart then return false end

    -- SHADOW BOSS KE PLAYER
    local direction =
        (humanoidRootPart.Position - bossPrimaryPart.Position).Unit
    local targetPosition = humanoidRootPart.Position - (direction * 10)
    targetPosition = Vector3.new(targetPosition.X, humanoidRootPart.Position.Y,
                                 targetPosition.Z)

    bossPrimaryPart.CFrame = CFrame.new(targetPosition) -- Shadow Boss yang pindah

    devMsg("üëπ " .. shadowBoss.Name .. " brought to you!")
    return true
end
-- ** Fn:TeleportNPCToPlayer (yg bener)
local function TeleportNPCToPlayer(npcName)
    local character = GetCharacter()
    if not character then return false end

    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return false end

    -- Cari NPC Doflamingo di workspace.Enemys
    local enemiesFolder = workspace:FindFirstChild("Enemys")
    if not enemiesFolder then return false end

    local doflamingo = enemiesFolder:FindFirstChild(npcName)
    if not doflamingo then return false end

    local bossPrimaryPart = doflamingo:FindFirstChild("HumanoidRootPart") or
                                doflamingo:FindFirstChildOfClass("Part")
    if not bossPrimaryPart then return false end

    -- ** CEK APAKAH NPC MASIH HIDUP **
    local humanoid = doflamingo:FindFirstChildOfClass("Humanoid")
    if not humanoid or humanoid.Health <= 0 then
        return false -- NPC sudah mati/ga ada humanoid, skip teleport
    end

    -- ** CEK JARAK - jangan teleport kalo udah deket **
    local distanceToPlayer = (humanoidRootPart.Position -
                                 bossPrimaryPart.Position).Magnitude
    if distanceToPlayer < 15 then -- Udah deket (15 stud), skip
        return false
    end

    -- TELEPORT KE DEPAN PLAYER (10 stud di depan)
    local playerCFrame = humanoidRootPart.CFrame
    local distance = 10
    local targetPosition = playerCFrame.Position +
                               (playerCFrame.LookVector * distance)
    targetPosition = Vector3.new(targetPosition.X, humanoidRootPart.Position.Y,
                                 targetPosition.Z)

    bossPrimaryPart.CFrame = CFrame.new(targetPosition)

    devMsg("üëπ " .. npcName .. " teleported to front!")
    return true
end
-- ** Fn:HandleAutoShadow
local function HandleAutoShadow(mapId)
    if not Options.ToggleAutoShadow.Value then
        devMsg("No Handle Auto Shadow!")
        return
    end

    -- ** Execute teleport ke map Shadow
    local success = SafeRemoteCall("LocalPlayerTeleport", {["mapId"] = mapId})

    if success then
        -- SETELAH SAMPAI DI MAP, LANGSUNG CARI BOSS DAN TELEPORT KE DEPANNYA
        devMsg("üîç Searching for Shadow Boss in current map...")
        task.wait(1)
        local shadowBoss = CheckCurrentMapForShadowBoss()
        task.wait(1)
        devMsg("Auto Handle Shadow Boss : " .. tostring(shadowBoss))
        if shadowBoss then
            if TeleportToShadowBoss(shadowBoss) then
                devMsg("Successfully teleported to Shadow Boss!")
            end
        end
    end
end
-- ** Fn:HandleAutoShadowAndDungeon
local function HandleAutoShadowAndDungeon(data, isShadow)
    if not Options.ToggleAutoShadowAndDungeon.Value then
        devMsg("No Handle Auto Shadow!")
        return
    end

    -- ** Jika sedang dalam mode shadow
    if isShadow then
        -- ** Matikan Toggle Superkill Jika Sedang Dalam model Auto Shadow
        -- if Options.ToggleSuperkill.Value then
        --     Options.ToggleSuperkill:SetValue(false)
        -- end

        -- ** Matikan Toggle Auto Farm Jika Sedang Dalam model Auto Shadow
        -- if Options.ToggleAutoFarm.Value then
        --     Options.ToggleAutoFarm:SetValue(false)
        -- end

        -- ** Execute teleport ke map Shadow
        local success =
            SafeRemoteCall("LocalPlayerTeleport", {["mapId"] = data})

        if success then
            -- SETELAH SAMPAI DI MAP, LANGSUNG CARI BOSS DAN TELEPORT KE DEPANNYA
            -- notify("üîç Searching for Shadow Boss in current map...")
            task.wait(1)
            local shadowBoss = CheckCurrentMapForShadowBoss()
            task.wait(1)
            if shadowBoss then

                local shadowName = shadowBoss.Name or "Unknown Boss"

                if TeleportToShadowBoss(shadowBoss) then
                    devMsg("Successfully teleported to Shadow Boss!")
                end

                -- **MONITOR BOSS SAMPAI MATI/HILANG, TERUS BALIK KE DG**
                while true do
                    -- Cek apakah boss masih ada
                    local currentBoss = CheckCurrentMapForShadowBoss()

                    if currentBoss then
                        -- **BOSS MASIH ADA, TUNGGU SAMPAI MATI**
                        local humanoid =
                            currentBoss.Model:FindFirstChild("Humanoid")
                        if humanoid then
                            devMsg("üëÄ Boss still alive - Health: " ..
                                       humanoid.Health)
                        end
                        task.wait(1)
                    else
                        devMsg("üíÄ Shadow Boss defeated/disappeared!")
                        break
                    end
                end
                -- BALIK KE 14
                devMsg("üîÑ Returning to map 14...")
                task.wait(1)
                SafeRemoteCall("LocalPlayerTeleport",
                               {["mapId"] = allMapLists[14]})
                task.wait(1)

                devMsg("Returned to map 14")
            end
        end
        return
    end

    -- ** Cek Notif DG
    local keywords = {"Dungeon unlocked", "you can Enter it in map"}
    for _, keyword in ipairs(keywords) do
        if string.find(data:lower(), keyword:lower()) then
            devMsg("üéØ Auto Dungeon triggered")
            task.wait(2)
            SafeRemoteCall("LocalPlayerTeleport", {["mapId"] = 50016})
            task.wait(1)
            -- ** Nyalain kalo ga nyala
            -- if not Options.ToggleSuperkill.Value then
            --     Options.ToggleSuperkill:SetValue(true)
            --     devMsg("Superkill diaktifkan")
            -- end
            return
        end
    end
end
-- ** Fn:HandleAutoShadowCityRaidAndOctopus
local hasTeleportedToCity = false
local shadowRaidInProgress = false
local function HandleAutoShadowCityRaidAndOctopus(data, isShadow)
    if not Options.ToggleAutoShadowCityRaidAndOctopus.Value then
        devMsg("No Handle HandleAutoShadowCityRaidAndOctopus!")
        return
    end

    -- ** Handle Shadow Raid notifications
    if data == "OpenCityRaid" then
        shadowRaidInProgress = true
        devMsg("üö´ Shadow Boss disabled - Shadow Raid started")
    elseif data == "CloseCityRaid" then
        shadowRaidInProgress = false -- ‚ö†Ô∏è INI YANG PENTING! Reset flag
        devMsg("‚úÖ Shadow Boss enabled - Shadow Raid finished")
    end

    -- ** Jika sedang dalam mode shadow
    if isShadow then

        if shadowRaidInProgress then
            devMsg("üö´ Skipping Shadow Boss - Shadow Raid in progress")
            return
        end

        -- ** Matikan Toggle Superkill Jika Sedang Dalam model Auto Shadow
        -- if Options.ToggleSuperkill.Value then
        --     Options.ToggleSuperkill:SetValue(false)
        -- end

        -- ** Matikan Toggle Auto Farm Jika Sedang Dalam model Auto Shadow
        -- if Options.ToggleAutoFarm.Value then
        --     Options.ToggleAutoFarm:SetValue(false)
        -- end

        -- ** Execute teleport ke map Shadow
        local success =
            SafeRemoteCall("LocalPlayerTeleport", {["mapId"] = data})
        task.wait(1)
        if success then
            -- SETELAH SAMPAI DI MAP, LANGSUNG CARI BOSS DAN TELEPORT KE DEPANNYA
            -- notify("üîç Searching for Shadow Boss in current map...")
            task.wait(1)
            local shadowBoss = CheckCurrentMapForShadowBoss()
            task.wait(1)
            if shadowBoss then

                local shadowName = shadowBoss.Name or "Unknown Boss"

                if TeleportToShadowBoss(shadowBoss) then
                    devMsg("Successfully teleported to Shadow Boss!")
                end

                -- **MONITOR BOSS SAMPAI MATI/HILANG, TERUS BALIK KE DG**
                while true do
                    -- Cek apakah boss masih ada
                    local currentBoss = CheckCurrentMapForShadowBoss()

                    if currentBoss then
                        -- **BOSS MASIH ADA, TUNGGU SAMPAI MATI**
                        local humanoid =
                            currentBoss.Model:FindFirstChild("Humanoid")
                        if humanoid then
                            devMsg("üëÄ Boss still alive - Health: " ..
                                       humanoid.Health)
                        end
                        task.wait(1)
                    else
                        devMsg("üíÄ Shadow Boss defeated/disappeared!")
                        break
                    end
                end
                -- BALIK KE Halloween
                devMsg("üîÑ Returning to map Halloween...")
                task.wait(1)
                SafeRemoteCall("LocalPlayerTeleport",
                               {["mapId"] = OtherMapsIdData["Halloween"]})
                task.wait(1)

                devMsg("Returned to map Halloween")
            end
        end
        return
    end

    -- ** City Raid
    if data == "StartChallenge" then devMsg("Start Chalenge") end

    if data == "OpenCityRaid" then
        devMsg("üöÄ Starting Auto Shadow Raid...")

        task.wait(3)

        -- ** Cek flag sebelum teleport
        if not hasTeleportedToCity then
            SafeRemoteCall("LocalPlayerTeleport", {["mapId"] = allMapLists[19]})
            task.wait(3)
            -- ** 2. Enter City Map Raid

            SafeRemoteCall("EnterCityRaidMap", 1000001)

            hasTeleportedToCity = true -- Set flag jadi true
            task.wait(3)
            devMsg("üìç First time teleport to City")
        else
            devMsg("üìç Already teleported to City, skipping...")
        end

        -- ** Aktifkan Superkill Aura
        -- if not Options.ToggleSuperkill.Value then
        --     Options.ToggleSuperkill:SetValue(true)
        --     devMsg("‚ö° Superkill activated")
        -- end

        -- ** Aktifkan Auto Collect
        if not Options.ToggleAutoCollectDrop.Value then
            Options.ToggleAutoCollectDrop:SetValue(true)
            devMsg("‚ö° Auto Collect activated")
        end

        task.wait(3)

        devMsg("Auto Shadow Raid started!")
    end

    if data == "UpdateRank" then devMsg("Update Rank") end

    if data == "CloseCityRaid" then
        devMsg("üîí CityRaid Closed")

        -- ** Reset flag ketika close
        hasTeleportedToCity = false
        devMsg("üîÑ Reset teleport flag for next run")

        task.wait(3)

        -- ** 2. Teleport to Dungeon
        SafeRemoteCall("LocalPlayerTeleport",
                       {["mapId"] = OtherMapsIdData["Halloween"]})

        task.wait(3)

        devMsg("City Raid completed successfully!")
    end
end
-- ** End:Fn

-- ** Start:Main
do
    -- ** Main:ClaimAllRewardsBtn
    local claimAllRewards = false
    local ClaimAllRewardsBtn = Tabs.Main:AddButton({
        Title = "Claim All Rewards",
        Description = "(Map 1 ‚Ä¢ Pumpkin ‚Ä¢ Code)",
        Callback = function()
            if claimAllRewards then
                devMsg("Auto Claim is already running!")
                return
            end

            claimAllRewards = true

            coroutine.wrap(function()
                -- ** 1. ClaimGroupReward
                SafeRemoteInvoke("ClaimGroupReward")
                task.wait(0.1)

                -- ** 2. ClaimAllPumpkins - dengan delay
                for _, mapId in ipairs(claimAllRewardsConfig.mapIdData) do
                    for _, pointId in ipairs(claimAllRewardsConfig.pointIdData) do
                        coroutine.wrap(function()
                            SafeRemoteCall("GetBoxGift", {
                                ["mapId"] = mapId,
                                ["pointId"] = pointId
                            })
                        end)()
                        task.wait(0.01) -- Delay antara pumpkin
                    end
                    devMsg("Map : " .. mapId)
                    task.wait(0.01) -- Delay antara map
                end

                -- ** 3. ClaimGiftCode - dengan delay
                for i = 1, 119 do
                    coroutine.wrap(function()
                        SafeRemoteInvoke("GiftCodeReceived", i)
                    end)()
                    devMsg("Index : " .. tostring(i))
                    task.wait(0.01) -- Delay antara gift code
                end

                devMsg("Claim All Rewards Success!")
                notify("Claim All Rewards Success!")
                claimAllRewards = false
            end)()
        end
    })

    -- ** Main:SpeedBoost
    local SpeedBoost = Tabs.Main:AddInput("SpeedBoost", {
        Title = "Speed Boost",
        Default = "80",
        Placeholder = "80",
        Numeric = true, -- Only allows numbers
        Finished = true, -- Only calls callback when you press enter
        Callback = function(Value)
            local char = GetCharacter()
            if char and char:FindFirstChild("Humanoid") then
                char.Humanoid.WalkSpeed = Value
            end
        end
    })

    -- ** Main:ToggleAntiAfk
    local AntiAFK
    local ToggleAntiAfk = Tabs.Main:AddToggle("ToggleAntiAfk", {
        Title = "Enable Anti-AFK",
        Default = true
    })
    ToggleAntiAfk:OnChanged(function(value)
        if AntiAFK then AntiAFK:Disconnect() end

        if value then
            AntiAFK = LocalPlayer.Idled:Connect(function()
                VirtualUser:CaptureController()
                VirtualUser:ClickButton2(Vector2.new())
            end)
            devMsg("Anti-AFK Enabled!")
        else
            devMsg("Anti-AFK Disabled!")
        end
    end)

    -- ** Start:Player
    -- ** Player:ToggleAutoRebirth
    local ToggleAutoRebirth = Tabs.Player:AddToggle("ToggleAutoRebirth", {
        Title = "Auto Rebirth",
        Default = false
    })
    ToggleAutoRebirth:OnChanged(function(value)
        if value then
            task.spawn(function()
                while Options.ToggleAutoRebirth.Value do
                    SafeRemoteCall("PlayerReborn")
                    task.wait(0.5)
                end
            end)
        end
    end)

    -- ** Player:ToggleAutoFuseWeapon
    local ToggleAutoFuseWeapon = Tabs.Player:AddToggle("ToggleAutoFuseWeapon", {
        Title = "Fuse Weapon",
        Default = false
    })
    ToggleAutoFuseWeapon:OnChanged(function(value)
        if value then
            task.spawn(function()
                while Options.ToggleAutoFuseWeapon.Value do
                    SafeRemoteCall("FuseWeapon")
                    task.wait(1)
                end
            end)
        end
    end)

    -- ** Player:ToggleAutoDeleteWeapon
    local ToggleAutoDeleteWeapon = Tabs.Player:AddToggle(
                                       "ToggleAutoDeleteWeapon", {
            Title = "Auto Delete Weapon (Unlock)",
            Default = false
        })
    ToggleAutoDeleteWeapon:OnChanged(function(value)
        if value then
            SafeRemoteCall("FuseWeapon")
            devMsg("Auto delete weapon tracked!")
        end
    end)
    -- ** Player:Event:UpdateWeapon
    local UpdateWeapon =
        ReplicatedStorage.Remotes:FindFirstChild("UpdateWeapon")
    if UpdateWeapon and UpdateWeapon:IsA("RemoteEvent") then
        UpdateWeapon.OnClientEvent:Connect(function(data)
            -- devMsg(HttpService:JSONEncode(data))
            if not Options.ToggleAutoDeleteWeapon.Value then return end

            for _, item in pairs(data) do
                devMsg("Item Guid : " .. tostring(item.guid))
                if item.value and not item.value.isLock and
                    not item.value.isEquip then
                    devMsg("Deleted success" .. tostring(item.guid))
                    SafeRemoteCall("DeleteWeapons", {item.guid})
                end
            end
        end)
    else
        devMsg("UpdateWeapon event not found!")
    end

    -- ** Farm:ToggleAutoPower
    local AutoPowerCoroutine
    local ToggleAutoPower = Tabs.Farm:AddToggle("ToggleAutoPower", {
        Title = "Auto Power",
        Default = false
    })
    ToggleAutoPower:OnChanged(function(value)
        if value then
            -- AutoPowerCoroutine = RunService.Heartbeat:Connect(function()
            --     if Options.ToggleAutoPower.Value then
            --         SafeRemoteCall("PlayerClickAttack", {})
            --     else
            --         AutoPowerCoroutine:Disconnect()
            --     end
            -- end)

            -- Untuk kecepatan maksimal dengan stabilitas
            while Options.ToggleAutoPower.Value do
                for i = 1, 10 do
                    SafeRemoteCall("PlayerClickAttack", {})
                    task.wait()
                end
                task.wait(0.1)
            end

            -- -- Untuk kecepatan maksimal dengan stabilitas
            -- while Options.ToggleAutoPower.Value do
            --     for i = 1, 10 do -- Multiple calls per frame
            --         SafeRemoteCall("PlayerClickAttack", {})
            --     end
            --     task.wait()
            -- end
            -- -- Start coroutine
            -- AutoPowerCoroutine = coroutine.create(function()
            --     while Options.ToggleAutoPower.Value do
            --         SafeRemoteCall("PlayerClickAttack", {})
            --         task.wait(0.01)
            --     end
            -- end)
            -- coroutine.resume(AutoPowerCoroutine)
        else
            -- Auto berhenti karena while loop cek Value
            devMsg("Stopped auto power")
        end
    end)

    -- ** Farm:ToggleAutoFarm
    local AutoFarmCoroutine
    local ToggleAutoFarm = Tabs.Farm:AddToggle("ToggleAutoFarm", {
        Title = "Auto Farm",
        Default = false
    })
    ToggleAutoFarm:OnChanged(function(value)
        if value then
            -- Start coroutine
            AutoFarmCoroutine = coroutine.create(function()
                -- MAIN LOOP - AUTO FARM MODE
                while Options.ToggleAutoFarm.Value do
                    local Enemys = workspace:FindFirstChild("Enemys")

                    -- Modified: Use SafeRemoteInvoke and SafeRemoteCall instead of instantKillAllEnemies
                    if Enemys then
                        -- Loop through all enemies
                        for _, obj in pairs(Enemys:GetChildren()) do
                            if obj:GetAttribute("EnemyGuid") then
                                -- First remote call
                                SafeRemoteInvoke("ClickEnemy", {
                                    ["enemyGuid"] = obj:GetAttribute("EnemyGuid"),
                                    ["enemyPos"] = obj:GetPivot().Position
                                })

                                -- Second remote call
                                SafeRemoteCall("PlayerClickAttack", {
                                    ["attackEnemyGUID"] = obj:GetAttribute(
                                        "EnemyGuid")
                                })
                            end
                        end

                        -- Tunggu sangat sebentar sebelum scan ulang
                        task.wait(0.1)
                    else
                        devMsg("No Enemys folder found in workspace")
                        task.wait(1)
                    end
                end
            end)
            coroutine.resume(AutoFarmCoroutine)
        else
            -- Stop coroutine
            if AutoFarmCoroutine and coroutine.status(AutoFarmCoroutine) ~=
                "dead" then
                -- Coroutine akan berhenti sendiri karena while loop cek Value
                devMsg("Stopped auto farm")
            end
        end
    end)

    -- ** Farm:ToggleAutoCollectDrop
    local AutoCollectCoroutine
    local ToggleAutoCollectDrop = Tabs.Farm:AddToggle("ToggleAutoCollectDrop", {
        Title = "Auto Collect Drop",
        Default = false
    })
    ToggleAutoCollectDrop:OnChanged(function(value)
        if value then
            -- Start coroutine
            AutoCollectCoroutine = coroutine.create(function()
                while Options.ToggleAutoCollectDrop.Value do
                    local goldsFolder = workspace:FindFirstChild("Golds")
                    local character = GetCharacter()
                    local humanoidRootPart = character and
                                                 character:FindFirstChild(
                                                     "HumanoidRootPart")
                    if goldsFolder and humanoidRootPart then
                        local playerPos = humanoidRootPart.Position
                        local playerCFrame = humanoidRootPart.CFrame
                        local items = goldsFolder:GetChildren()

                        -- PROCESS SEMUA ITEMS SEKALIGUS DALAM 1 FRAME!
                        for _, item in pairs(items) do
                            if item:IsA("Part") then
                                local guid = item:GetAttribute("GUID")

                                if guid then
                                    -- ‚≠ê POSISI DI DEPAN PLAYER ‚≠ê
                                    local distance = 0.5 -- 0.5 stud di depan
                                    local targetPos = playerCFrame *
                                                          CFrame.new(0, 0,
                                                                     -distance)
                                                              .Position

                                    -- TELEPORT ITEM KE DEPAN PLAYER
                                    item.CFrame = CFrame.new(targetPos)

                                    -- Collect item pake coroutine juga
                                    -- coroutine.wrap(function()
                                    --     SafeRemoteInvoke("CollectItem", guid)
                                    -- end)()
                                    -- task.wait(0.1)
                                end
                            end
                        end

                        if #items > 0 then
                            -- devMsg("üí• PROCESSED " .. #items .. " ITEMS AT ONCE!")
                        end
                    end
                    task.wait(0.5) -- Jeda lebih cepat
                end
            end)
            coroutine.resume(AutoCollectCoroutine)
        else
            devMsg("Stopped auto collect drop")
        end
    end)

    -- ** Farm:HideReward
    local HideReward = false
    Tabs.Farm:AddButton({
        Title = "Hide Reward",
        -- Description = "Auto Claim All Available Gift Codes",
        Callback = function()
            if HideReward then
                devMsg("Hide Reward is already!")
                return
            end

            -- Hapus UI Elements di Player GUI
            local playerGui = game.Players.LocalPlayer:FindFirstChild(
                                  "PlayerGui")
            if playerGui then
                -- Cari TipsPanel di PlayerGui
                local TipsPanel = playerGui:FindFirstChild("TipsPanel")
                if TipsPanel then
                    -- Hapus FloatIngTextFrame
                    local floatingTextFrame =
                        TipsPanel:FindFirstChild("FloatIngTextFrame")
                    if floatingTextFrame then
                        floatingTextFrame:Destroy()
                        devMsg("FloatIngTextFrame destroyed!")
                    end

                    -- Hapus RewardsFrame
                    local rewardsFrame =
                        TipsPanel:FindFirstChild("RewardsFrame")
                    if rewardsFrame then
                        rewardsFrame:Destroy()
                        devMsg("RewardsFrame destroyed!")
                    end
                else
                    devMsg("TipsPanel not found in PlayerGui!")
                end
            else
                devMsg("PlayerGui not found!")
            end

            -- Optional: Juga hapus dari ReplicatedStorage UI (kalau ada)
            local repStorageUI = ReplicatedStorage:FindFirstChild("UI")
            if repStorageUI then
                local TipsPanelRep = repStorageUI:FindFirstChild("TipsPanel")
                if TipsPanelRep then
                    local floatingTextFrameRep =
                        TipsPanelRep:FindFirstChild("FloatIngTextFrame")
                    if floatingTextFrameRep then
                        floatingTextFrameRep:Destroy()
                        devMsg(
                            "FloatIngTextFrame in ReplicatedStorage destroyed!")
                    end

                    local rewardsFrameRep =
                        TipsPanelRep:FindFirstChild("RewardsFrame")
                    if rewardsFrameRep then
                        rewardsFrameRep:Destroy()
                        devMsg("RewardsFrame in ReplicatedStorage destroyed!")
                    end
                end
            end

            HideReward = true
            devMsg("All reward UI elements hidden successfully!")
        end
    })

    -- ** Start:Teleport
    -- ** Teleport:FindShadowBtn
    local FindShadowRunning = false
    local FindShadowBtn = Tabs.Teleport:AddButton({
        Title = "Find Shadow All Maps",
        Description = "",
        Callback = function()
            if FindShadowRunning then
                devMsg("Find Shadow is already running!")
                return
            end

            FindShadowRunning = true

            -- MAIN EXECUTION
            task.spawn(function()
                for mapNumber = 11, 21 do
                    devMsg("üîç Checking Map " .. mapNumber .. "...")

                    local succTeleMap = TeleportToMap(mapNumber)

                    if succTeleMap then
                        task.wait(0.5)
                        local shadowBoss = CheckCurrentMapForShadowBoss()
                        task.wait(0.5)
                        if shadowBoss then
                            local shadowName = shadowBoss.Name or "Unknown Boss"
                            devMsg(
                                "üéØ Found Shadow Boss in Map " .. mapNumber ..
                                    ": " .. shadowBoss.Name)
                            local succComeToDady =
                                TeleportToShadowBoss(shadowBoss)
                            task.wait(0.5)
                            if succComeToDady then
                                FindShadowRunning = false
                                return
                            end
                        else
                            devMsg("No Shadow Boss in Map " .. mapNumber)
                        end
                    end
                end
                notify("No Shadow Found in All Maps")
            end)

            FindShadowRunning = false
        end
    })

    -- ** Teleport:BypassTeleport
    Tabs.Teleport:AddDropdown("BypassTeleport", {
        Title = "Bypass Teleport",
        Description = "",
        Values = {"Select Location", "Dungeon", "Tower", "Relic"},
        Multi = false,
        Default = "Select Location"
    }):OnChanged(function(value)
        local BypassTeleportConfig = {
            {Name = "Dungeon", mapId = 50016}, {Name = "Tower", mapId = 50107},
            {Name = "Relic", mapId = 50900}
        }

        if value == "Select Location" then
            devMsg("Please select a location to teleport")
            return
        end

        -- Cari mapId berdasarkan nama location
        local selectedMapId = nil
        for _, location in ipairs(BypassTeleportConfig) do
            if location.Name == value then
                selectedMapId = location.mapId
                break
            end
        end

        if selectedMapId then
            devMsg("üöÄ Teleporting to: " .. value .. " (Map ID: " ..
                       selectedMapId .. ")")

            SafeRemoteCall("LocalPlayerTeleport", {["mapId"] = selectedMapId})
            task.wait(1)

        else
            devMsg("Location not found: " .. value)
        end
    end)

    Tabs.Teleport:AddSection("Auto Farm")
    -- ** Teleport:ToggleAutoDungeon
    local ToggleAutoDungeon = Tabs.Teleport:AddToggle("ToggleAutoDungeon", {
        Title = "Auto Dungeon",
        Default = false
    })
    ToggleAutoDungeon:OnChanged(function(value)
        if value then
            -- Matikan toggle lainnya
            turnOffOtherToggles("ToggleAutoDungeon")
            devMsg("Auto Dungeon activated")
        else
            devMsg("Auto Dungeon deactivated")
        end
    end)

    -- ** Teleport:ToggleAutoTower
    local ToggleAutoTower = Tabs.Teleport:AddToggle("ToggleAutoTower", {
        Title = "Auto Tower",
        Default = false
    })
    ToggleAutoTower:OnChanged(function(value)
        if value then
            -- Matikan toggle lainnya
            turnOffOtherToggles("ToggleAutoTower")
            devMsg("Auto Tower activated")
        else
            devMsg("Auto Tower deactivated")
        end
    end)

    -- ** Teleport:ToggleAutoRelic
    local ToggleAutoRelic = Tabs.Teleport:AddToggle("ToggleAutoRelic", {
        Title = "Auto Relic",
        Default = false
    })
    ToggleAutoRelic:OnChanged(function(value)
        if value then
            -- Matikan toggle lainnya
            turnOffOtherToggles("ToggleAutoRelic")
            devMsg("Auto Relic activated")
        else
            devMsg("Auto Relic deactivated")
        end
    end)

    Tabs.Teleport:AddSection("Auto Boss")
    -- ** Teleport:ToggleAutoShadow
    local ToggleAutoShadow = Tabs.Teleport:AddToggle("ToggleAutoShadow", {
        Title = "Auto Shadow",
        Default = false
    })
    ToggleAutoShadow:OnChanged(function(value)
        if value then
            -- Matikan toggle lainnya
            turnOffOtherToggles("ToggleAutoShadow")
            devMsg("Auto Shadow activated")
        else
            devMsg("Auto Shadow deactivated")
        end
    end)
    -- ** End:Teleport

    -- ** Start:EggSpin
    Tabs.EggSpin:AddSection("Hero Spin")
    -- ** EggSpin:ToggleAutoSpinHero
    local ToggleAutoSpinHero = Tabs.EggSpin:AddToggle("ToggleAutoSpinHero", {
        Title = "Auto Spin Hero",
        Description = "Must be in a place where there is spin",
        Default = false,
        Callback = function(value)
            if value then
                task.spawn(function()
                    local mapsFolder = workspace:FindFirstChild("Maps")
                    if not mapsFolder then
                        devMsg("Maps folder tidak ditemukan!")
                        Options.ToggleAutoSpinHero:SetValue(false)
                        return
                    end

                    local eggPart = mapsFolder:FindFirstChild("Egg", true)
                    if not eggPart then
                        devMsg("Egg part tidak ditemukan!")
                        Options.ToggleAutoSpinHero:SetValue(false)
                        return
                    end

                    local drawCardPlatformId = eggPart:GetAttribute("Id")
                    if not drawCardPlatformId then
                        devMsg("ID attribute tidak ditemukan pada Egg!")
                        Options.ToggleAutoSpinHero:SetValue(false)
                        return
                    end

                    while Options.ToggleAutoSpinHero.Value do
                        local success = pcall(function()
                            SafeRemoteInvoke("ExtractHero", {
                                ["drawCardPlatformId"] = drawCardPlatformId,
                                ["count"] = 1
                            })
                        end)

                        if not success then
                            warn("Gagal memanggil ExtractHero")
                            break
                        end

                        task.wait(Options.AutoSpinHeroSlider)
                    end
                end)
            else
                devMsg("Hero spin stopped")
            end
        end
    })
    local AutoSpinHeroSlider = Tabs.EggSpin:AddSlider("AutoSpinHeroSlider", {
        Title = "Delay",
        -- Description = "This is a slider",
        Default = 0.1,
        Min = 0.01,
        Max = 5,
        Rounding = 2,
        Callback = function(value) Options.AutoSpinHeroSlider = value end
    })
    Options.AutoSpinHeroSlider:SetValue(0.1)
    -- ** EggSpin:AutoSpinHalo
    Tabs.EggSpin:AddSection("Halo Spin")
    local function TurnOfOtherToggleHalo(currentToggle)
        local otherToggles = {
            "ToggleAutoHaloSilver", "ToggleAutoHaloGold",
            "ToggleAutoHaloDiamond"
        }

        for _, toggleName in ipairs(otherToggles) do
            if toggleName ~= currentToggle and Options[toggleName] then
                Options[toggleName]:SetValue(false)
            end
        end
    end
    local HaloType = {Silver = 1, Gold = 2, Diamond = 3}
    local haloOrder = {"Silver", "Gold", "Diamond"}
    for _, haloName in ipairs(haloOrder) do
        local haloId = HaloType[haloName]
        local toggleName = "ToggleAutoHalo" .. haloName
        local toggle = Tabs.EggSpin:AddToggle(toggleName, {
            Title = "Halo " .. haloName,
            Default = false,
            Callback = function(value)
                if value then
                    -- Matikan toggle lain
                    TurnOfOtherToggleHalo(toggleName)
                    -- Jalankan loop otomatis
                    task.spawn(function()
                        while Options[toggleName].Value do
                            SafeRemoteInvoke("RerollHalo", haloId)
                            task.wait(Options.AutoSpinHaloDelay)
                        end
                    end)
                else
                    devMsg("Halo " .. haloName .. " stopped")
                end
            end
        })
    end
    -- ** EggSpin:AutoSpinHaloDelay
    local AutoSpinHaloDelay = Tabs.EggSpin:AddSlider("AutoSpinHaloDelay", {
        Title = "Delay",
        Default = 0.1,
        Min = 0.1,
        Max = 5,
        Rounding = 1,
        Callback = function(value) Options.AutoSpinHaloDelay = value end
    })
    Options.AutoSpinHaloDelay:SetValue(0.1)
    -- ** Exchange Halo Type Here
    -- 
    -- ** End:EggSpin

    -- ** Start:Machine
    local ToggleAccesoryGachaBooster = Tabs.Machine:AddToggle(
                                           "ToggleAccesoryGachaBooster", {
            Title = "Gacha Booster",
            Description = "activate if u have purchased items for the roll",
            Default = false
        })
    ToggleAccesoryGachaBooster:OnChanged(function(value)
        Options.ToggleAccessoryGachaBooster = value
    end)
    local function TurnOfOtherToggleMachine(currentToggle)
        local otherToggles = {
            "ToggleAutoMachineTalisman", "ToggleAutoMachineSilk",
            "ToggleAutoMachineMask", "ToggleAutoMachineAwkening",
            "ToggleAutoMachineOrnament", "ToggleAutoMachineBreath",
            "ToggleAutoMachineElemental"
        }

        for _, toggleName in ipairs(otherToggles) do
            if toggleName ~= currentToggle and Options[toggleName] then
                Options[toggleName]:SetValue(false)
            end
        end
    end
    Tabs.Machine:AddSection("Auto Spin Machine")
    local machineType = {
        Mask = 400001,
        Awkening = 400002,
        Ornament = 400003,
        Breath = 400004,
        Talisman = 400005,
        Silk = 400006,
        Elemental = 400007
    }
    local machineOrder = {
        "Mask", "Awkening", "Ornament", "Breath", "Talisman", "Silk",
        "Elemental"
    }
    for _, machineName in ipairs(machineOrder) do
        local machineId = machineType[machineName]
        local toggleName = "ToggleAutoMachine" .. machineName
        local toggle = Tabs.Machine:AddToggle(toggleName, {
            Title = machineName,
            Default = false,
            Callback = function(value)
                if value then
                    -- Matikan toggle lain
                    TurnOfOtherToggleMachine(toggleName)
                    -- Jalankan loop otomatis
                    task.spawn(function()
                        while Options[toggleName].Value do
                            SafeRemoteInvoke("RerollOrnament", {
                                ["machineId"] = machineId,
                                ["isAuto"] = Options.ToggleAccesoryGachaBooster
                                    .Value
                            })
                            -- task.wait(Options.AutoSpinMachineDelay)
                            task.wait()
                        end
                    end)
                else
                    devMsg("Machine " .. machineName .. " stopped")
                end
            end
        })
    end
    -- -- ** Machine:AutoSpinMachineDelay
    -- local AutoSpinMachineDelay = Tabs.Machine:AddSlider("AutoSpinMachineDelay",
    --                                                     {
    --     Title = "Delay",
    --     Default = 0.1,
    --     Min = 0.01,
    --     Max = 5,
    --     Rounding = 2,
    --     Callback = function(value) Options.AutoSpinMachineDelay = value end
    -- })
    -- Options.AutoSpinMachineDelay:SetValue(0.1)
    -- ** End:Machine

    -- ** Start:Antique
    -- ** Antique:AntiqueDelay
    local AntiqueDelay = Tabs.Antique:AddSlider("AntiqueDelay", {
        Title = "Delay",
        Default = 0.5,
        Min = 0.1,
        Max = 5,
        Rounding = 1,
        Callback = function(value) Options.AntiqueDelay = value end
    })
    Options.AntiqueDelay:SetValue(0.5)
    -- ** Exchange Antique Here
    -- 
    Tabs.Antique:AddSection("Auto Open Antique")
    local AntiqueType = {
        ["Antique Box 1"] = 820001,
        ["Antique Box 2"] = 820002,
        ["Antique Box 3"] = 820003,
        ["Antique Box 4"] = 820004,
        ["Antique Box 5"] = 820005
    }
    -- Function untuk mematikan toggle lainnya
    local function TurnOfOtherToggleAntique(currentToggle)
        local otherToggles = {
            "ToggleAutoAntique1", "ToggleAutoAntique2", "ToggleAutoAntique3",
            "ToggleAutoAntique4", "ToggleAutoAntique5"
        }

        for _, toggleName in ipairs(otherToggles) do
            if toggleName ~= currentToggle and Options[toggleName] then
                Options[toggleName]:SetValue(false)
            end
        end
    end
    local antiqueOrder = {
        "Antique Box 1", "Antique Box 2", "Antique Box 3", "Antique Box 4",
        "Antique Box 5"
    }
    for index, antiqueName in ipairs(antiqueOrder) do
        local antiqueId = AntiqueType[antiqueName]
        local toggleName = "ToggleAutoAntique" .. index -- Gunakan index sebagai penanda

        local toggle = Tabs.Antique:AddToggle(toggleName, {
            Title = antiqueName,
            Default = false,
            Callback = function(value)
                if value then
                    -- Matikan toggle lain
                    TurnOfOtherToggleAntique(toggleName)
                    -- Jalankan loop otomatis
                    task.spawn(function()
                        while Options[toggleName].Value do
                            SafeRemoteCall("OpenAntiqueBox", antiqueId)
                            task.wait(Options.AntiqueDelay)
                        end
                    end)
                else
                    devMsg("Antique " .. antiqueName .. " stopped")
                end
            end
        })
    end
    -- ** End:Antique

    -- ** Start:Mounts
    -- ** Mounts:DropdownMounts1
    local DropdownMounts1 = Tabs.Mounts:AddDropdown("DropdownMounts1", {
        Title = "Mount list 1",
        Description = "",
        Values = {
            "Choose Mount List 1", "Cloud", "Lightning Cloud", "Gold Cloud",
            "Magic Skateboard", "Sci-Fi Skateboard", "Pomni", "DogeCar",
            "MagicCarpet", "ElectronicFantasy", "FireWheel", "WaterWheel",
            "ChristmasSleigh", "BananaCar", "FlyingSwords", "JusticeOnslaught",
            "BrokenSky", "Nimbus", "RubberDukiro", "Batmobile",
            "TorrentOfSteel", "SuperDaddy", "FlyingSaucer", "rocket",
            "spaceship", "Flyingleaves", "plane", "chariot", "DarkElves",
            "Mantarays", "DeepSeaMonstrosity", "WarMachine"
        },
        Multi = false,
        Default = "Choose Mount List 1"
    })
    DropdownMounts1:OnChanged(function(value)
        if value == "Choose Mount List 1" then
            devMsg("Please select a mount")
            return
        end

        -- Cari mount ID berdasarkan nama yang dipilih
        local selectedMountId = nil
        for _, mount in ipairs(MountLists.Mounts1) do
            if mount.Name == value then
                selectedMountId = mount.Id
                break
            end
        end

        if selectedMountId then
            SafeRemoteCall("EquipMount", selectedMountId)
            devMsg("Equipped mount: " .. value .. " (ID: " .. selectedMountId ..
                       ")")
        else
            devMsg("Mount not found: " .. value)
        end
    end)
    -- ** Mounts:DropdownMounts2
    local DropdownMounts2 = Tabs.Mounts:AddDropdown("DropdownMounts2", {
        Title = "Mount list 2",
        Description = "",
        Values = {
            "Choose Mount List 2", "hamburger", "dragon", "Sharkplanes",
            "Swimmingrings", "CrocSpotters", "flyingfish", "tank", "RoboCop",
            "SpeedSnail", "TaiChiPanda", "Starfleet", "JinDouYun", "Fruitcarts",
            "Frigate", "Pumpkincarts", "BattleTrain", "DreamyEra", "AE86",
            "Hovercraft", "BlueFlash", "DreamyLightWheel", "ChristmasPresent",
            "AirboatMissile", "Aircar", "Ravager", "Dragon", "Eggcart",
            "Unicorn", "CapibarelloCocosini", "Rainbow popsicle", "LittleBee",
            "BigToothCar"
        },
        Multi = false,
        Default = "Choose Mount List 2"
    })
    DropdownMounts2:OnChanged(function(value)
        if value == "Choose Mount List 2" then
            devMsg("Please select a mount from list 2")
            return
        end
        -- Cari mount ID berdasarkan nama yang dipilih
        local selectedMountId = nil
        for _, mount in ipairs(MountLists.Mounts2) do
            if mount.Name == value then
                selectedMountId = mount.Id
                break
            end
        end

        if selectedMountId then
            SafeRemoteCall("EquipMount", selectedMountId)
            devMsg("Equipped mount from list 2: " .. value .. " (ID: " ..
                       selectedMountId .. ")")
        else
            devMsg("Mount not found in list 2: " .. value)
        end
    end)
    -- ** End:Mounts

    -- ** Start:Server
    -- ** Server:HopServer **
    local HopServerBtn = Tabs.Server:AddButton({
        Title = "Hop Server",
        Callback = function()
            -- Dapatkan server list terbaru
            local servers = GetActiveServers()

            if #servers == 0 then
                warn("No available servers found!")
                return
            end

            -- Filter server dengan 2-3 players (recommended)
            local recommendedServers = {}
            for _, server in ipairs(servers) do
                if server.players >= 2 and server.players <= 3 then
                    table.insert(recommendedServers, server)
                end
            end

            -- Pilih server: prioritaskan yang 2-3 players, jika tidak ada pilih yang paling sepi
            local targetServer
            if #recommendedServers > 0 then
                -- Pilih random dari recommended servers
                targetServer = recommendedServers[math.random(1,
                                                              #recommendedServers)]
                warn(
                    "Hopping to recommended server (" .. targetServer.players ..
                        "/" .. targetServer.maxPlayers .. " players)")
            else
                -- Pilih server dengan pemain paling sedikit
                targetServer = servers[1]
                warn("Hopping to available server (" .. targetServer.players ..
                         "/" .. targetServer.maxPlayers .. " players)")
            end

            -- Teleport ke server
            task.wait(0.5)
            local success, errorMsg = pcall(function()
                TeleportService:TeleportToPlaceInstance(game.PlaceId,
                                                        targetServer.id,
                                                        game.Players.LocalPlayer)
            end)

            if not success then
                warn("Server hop failed: " .. tostring(errorMsg))
            end
        end
    })
    -- ** Rejoin Server
    local RejoinServerBtn = Tabs.Server:AddButton({
        Title = "Rejoin Server",
        Callback = function()
            -- Rejoin server
            local success, errorMsg = pcall(function()
                TeleportService:Teleport(game.PlaceId, game.Players.LocalPlayer)
            end)

            if not success then
                devMsg("Error: " .. tostring(errorMsg))
            end

        end
    })
    -- ** End:Server

    -- ** Start:Premium
    if isPremiumUser() then
        -- ** Farm:ToggleSuperkill
        local SuperkillCoroutine
        local ToggleSuperkill = Tabs.Premium:AddToggle("ToggleSuperkill", {
            Title = "Superkill",
            Default = false
        })
        ToggleSuperkill:OnChanged(function(value)
            if value then
                -- Start coroutine
                SuperkillCoroutine = coroutine.create(function()
                    if not Options.ToggleAutoCollectDrop.Value then
                        Options.ToggleAutoCollectDrop:SetValue(true)
                    end
                    -- MAIN LOOP - INSTANT MODE
                    while Options.ToggleSuperkill.Value do
                        local Enemys = workspace:FindFirstChild("Enemys")

                        -- instantKillAllEnemies(Enemys)
                        if Enemys then
                            -- devMsg("üíÄ Instant killing all enemies...")
                            instantKillAllEnemies(Enemys)

                            -- Tunggu sangat sebentar sebelum scan ulang
                            task.wait(0.01)
                        else
                            devMsg("No Enemys folder found in workspace")
                            task.wait(1)
                        end
                    end
                end)
                coroutine.resume(SuperkillCoroutine)
            else
                -- Stop coroutine
                if SuperkillCoroutine and coroutine.status(SuperkillCoroutine) ~=
                    "dead" then
                    -- Coroutine akan berhenti sendiri karena while loop cek Value
                    devMsg("Stopped instant kill")
                    if Options.ToggleAutoCollectDrop.Value then
                        Options.ToggleAutoCollectDrop:SetValue(false)
                    end
                end
            end
        end)
        -- ** Premium:Event:HeroMoveToEnemyPos
        local HeroMoveToEnemyPos = ReplicatedStorage.Remotes:FindFirstChild(
                                       "HeroMoveToEnemyPos")
        if HeroMoveToEnemyPos and HeroMoveToEnemyPos:IsA("RemoteEvent") then
            HeroMoveToEnemyPos.OnClientEvent:Connect(function(data)
                if not Options.ToggleSuperkill.Value then return end

                -- Gunakan coroutine untuk handle event
                coroutine.wrap(function()
                    for guid, position in pairs(data.heroTagetPosInfos or {}) do
                        -- devMsg("üì¶ HeroMoveToEnemyPos: " .. tostring(data))

                        -- Fix: Pastikan position adalah CFrame, bukan Vector3
                        local targetCFrame
                        if typeof(position) == "Vector3" then
                            targetCFrame = CFrame.new(position)
                        else
                            targetCFrame = position
                        end

                        -- while Options.ToggleSuperkill.Value do
                        --     for i = 1, 3 do
                        --         SafeRemoteCall("HeroUseSkill", {
                        --             ["heroGuid"] = guid,
                        --             ["attackType"] = 1,
                        --             ["userId"] = LocalPlayer.UserId,
                        --             ["enemyGuid"] = data.attackTarget
                        --         })
                        --     end
                        --     task.wait(0.1)
                        -- end

                        -- local attacktype = math.random(1, 3)
                        SafeRemoteCall("HeroUseSkill", {
                            ["heroGuid"] = guid,
                            ["attackType"] = 3,
                            ["userId"] = LocalPlayer.UserId,
                            ["enemyGuid"] = data.attackTarget
                        })
                        -- local attacktype = math.random(1,20)
                        -- SafeRemoteCall("HeroSkillHarm", {
                        --     ["heroGuid"] = guid,
                        --     ["harmIndex"] = 1,
                        --     ["isSkill"] = false,
                        --     ["skillId"] = 200633
                        -- })
                        task.wait(0.08)
                    end
                end)()
            end)
        end
        -- ** Premium:End:ToggleSuperkill

        Tabs.Premium:AddSection("Auto Boss")
        -- ** Premium:MaxFloor:Start
        local maxFloorPlayer = 0
        local MaxFloor = Tabs.Premium:AddInput("MaxFloor", {
            Title = "Max Floor (Dg)",
            -- Description = "Automatically to Halloween if it is on the floor you filled in",
            Default = "0",
            Placeholder = "0-200",
            Numeric = true, -- Only allows numbers
            Finished = true, -- Only calls callback when you press enter
            Callback = function(Value)
                if Value then
                    maxFloorPlayer = tonumber(Value) or 0 -- Convert ke number
                end
            end
        })
        -- ** Event:TowerEnterNextLevel (Dungeon)
        local TowerEnterNextLevel = ReplicatedStorage.Remotes:FindFirstChild(
                                        "TowerEnterNextLevel")
        if TowerEnterNextLevel and TowerEnterNextLevel:IsA("RemoteEvent") then
            TowerEnterNextLevel.OnClientEvent:Connect(function(data)
                if data and maxFloorPlayer ~= 0 and maxFloorPlayer == data then
                    SafeRemoteCall("LocalPlayerTeleport",
                                   {["mapId"] = OtherMapsIdData["Halloween"]})
                    task.wait(1)
                end
            end)
        end
        -- ** Premium:MaxFloor:End

        -- ** Premium:ToggleAutoShadowCityRaidAndOctopus
        local ToggleAutoShadowCityRaidAndOctopus =
            Tabs.Premium:AddToggle("ToggleAutoShadowCityRaidAndOctopus", {
                Title = "Auto Shadow + City Raid + Octopus",
                Default = false
            })
        ToggleAutoShadowCityRaidAndOctopus:OnChanged(function(value)
            if value then
                -- Matikan toggle lainnya
                turnOffOtherToggles("ToggleAutoShadowCityRaidAndOctopus")
                devMsg("ToggleAutoShadowCityRaidAndOctopus activated")
            else
                devMsg("ToggleAutoShadowCityRaidAndOctopus deactivated")
            end
        end)
        -- ** Premium:End:ToggleAutoShadowCityRaidAndOctopus

        -- ** Premium:ToggleAutoShadowAndDungeon
        local ToggleAutoShadowAndDungeon =
            Tabs.Premium:AddToggle("ToggleAutoShadowAndDungeon", {
                Title = "Auto Shadow + Dungeon",
                Default = false
            })
        ToggleAutoShadowAndDungeon:OnChanged(function(value)
            if value then
                -- Matikan toggle lainnya
                turnOffOtherToggles("ToggleAutoShadowAndDungeon")
                devMsg("Auto Shadow & Dungeon activated")
            else
                devMsg("Auto Shadow & Dungeon deactivated")
            end
        end)
        -- ** Fn:StartNPCMonitor
        local function StartNPCMonitor(npcName)
            coroutine.wrap(function()
                while Options.ToggleAutoShadowAndDungeon.Value do
                    TeleportNPCToPlayer(npcName)
                    task.wait(6) -- Cek setiap 6 detik
                end
            end)()
        end
        -- ** Start monitor Doflamingo ketika toggle diaktifkan
        -- Simpan callback asli dulu
        local originalCallback = Options.ToggleAutoShadowAndDungeon.Callback
        -- Override callback untuk tambahkan monitor
        Options.ToggleAutoShadowAndDungeon.Callback = function(Value)
            -- Jalankan callback asli
            originalCallback(Value)
            -- Start/stop monitor Doflamingo
            if Value then
                devMsg("üîÑ Starting Doflamingo monitor...")
                StartNPCMonitor("DonquixoteDoflamingo5")
            else
                devMsg("‚èπÔ∏è Stopping Doflamingo monitor...")
            end
        end
        -- ** Jika toggle sudah aktif dari awal, start monitor
        if Options.ToggleAutoShadowAndDungeon.Value then
            task.wait(2) -- Kasih delay sedikit
            devMsg("üîÑ Auto-starting Doflamingo monitor...")
            StartNPCMonitor("DonquixoteDoflamingo5")
        end
        -- ** Premium:End:ToggleAutoShadowAndDungeon

        -- ** Premium:ToggleAutoOctopus
        local AutoOctopusCoroutine
        local ToggleAutoOctopus = Tabs.Premium:AddToggle("ToggleAutoOctopus", {
            Title = "Auto Octopus + Pumpkin Boss",
            Default = false
        })
        local function attackOctopusPumpkin(enemy)
            local enemyGuid = enemy:GetAttribute("EnemyGuid")
            local enemyPos = enemy:GetPivot().Position

            if enemyGuid then
                SafeRemoteInvoke("ClickEnemy", {
                    ["enemyGuid"] = enemyGuid,
                    ["enemyPos"] = enemyPos
                })
                SafeRemoteCall("PlayerClickAttack",
                               {["attackEnemyGUID"] = enemyGuid})
            end
            task.wait(0.1)
        end
        ToggleAutoOctopus:OnChanged(function(value)
            if value then
                devMsg("üî´ Auto Octopus activated")

                -- Start coroutine
                AutoOctopusCoroutine = coroutine.create(function()
                    while Options.ToggleAutoOctopus.Value do
                        local Enemys = workspace:FindFirstChild("Enemys")
                        if Enemys then
                            -- Attack semua octopus
                            for _, enemy in pairs(Enemys:GetChildren()) do
                                if not Options.ToggleAutoOctopus.Value then
                                    break
                                end

                                if enemy:IsA("Model") and enemy.Name ==
                                    "octopus" then
                                    devMsg("üêô Attacking Octopus")
                                    attackOctopusPumpkin(enemy)
                                end
                            end

                            -- Attack Pumpkin
                            local pumpkin =
                                Enemys:FindFirstChild("PumpkinCount")
                            if pumpkin and pumpkin:IsA("Model") then
                                devMsg("üéÉ Attacking Pumpkin")
                                attackOctopusPumpkin(pumpkin)
                            end
                        else
                            devMsg("No Enemys folder found")
                        end

                        task.wait(0.1) -- Delay antara setiap scan
                    end
                    devMsg("Auto Octopus stopped")
                end)
                coroutine.resume(AutoOctopusCoroutine)

            else
                devMsg("Auto Octopus deactivated")
                -- Auto berhenti karena while loop cek Value
            end
        end)
        -- ** Premium:End:ToggleAutoOctopus

        -- ** Premium:Potion Merge Section
        Tabs.Premium:AddSection("Potion Merge")

        -- Variables
        local selectedTier = nil
        local selectedPotion = nil
        local autoMergeEnabled = false
        local mergeDelay = 1 -- Default 1 detik

        -- Dropdown 1: Pilih Tier (Lv2/Lv3)
        local tierDropdown = Tabs.Premium:AddDropdown("PotionTierDropdown", {
            Title = "Potion LV",
            Values = {"Choose Tier", "Level 2 Potions", "Level 3 Potions"},
            Multi = false,
            Default = "Choose Tier"
        })

        -- Dropdown 2: Pilih Potion (akan di-update berdasarkan tier)
        local potionDropdown = Tabs.Premium:AddDropdown("PotionTypeDropdown", {
            Title = "Potion Type",
            Values = {"Choose tier first"},
            Multi = false,
            Default = "Choose tier first"
        })

        -- Slider untuk delay
        local delaySlider = Tabs.Premium:AddSlider("MergeDelaySlider", {
            Title = "Merge Delay",
            Default = 1,
            Min = 0.5,
            Max = 5,
            Rounding = 1,
            Callback = function(Value)
                mergeDelay = Value
                devMsg("Merge delay: " .. Value .. " seconds")
            end
        })

        -- Toggle untuk enable/disable auto merge
        local autoMergeToggle = Tabs.Premium:AddToggle("AutoPotionMerge", {
            Title = "Auto Potion Merge",
            Default = false,
            Callback = function(Value)
                autoMergeEnabled = Value
                if Value then
                    if selectedTier and selectedPotion then
                        devMsg("‚úÖ Auto Potion Merge ENABLED - " ..
                                   selectedPotion.Name)
                        -- Start the loop in a separate thread
                        task.spawn(startAutoMerge)
                    else
                        devMsg("‚ùå Please select both tier and potion first")
                        autoMergeToggle:SetValue(false)
                    end
                else
                    devMsg("‚ùå Auto Potion Merge DISABLED")
                end
            end
        })

        -- Handler ketika tier dipilih
        tierDropdown:OnChanged(function(value)
            if value == "Choose Tier" then
                selectedTier = nil
                potionDropdown:SetValues({"Choose tier first"})
                potionDropdown:SetValue("Choose tier first")
                autoMergeToggle:SetValue(false)
                devMsg("Tier selection cleared")
                return
            end

            -- Cari tier yang dipilih
            for tierKey, tierData in pairs(PotionData) do
                if tierData.TierName == value then
                    selectedTier = tierData

                    -- Update potion dropdown
                    local potionNames = {"Choose Potion"}
                    for _, potion in ipairs(tierData.Items) do
                        table.insert(potionNames, potion.Name)
                    end

                    potionDropdown:SetValues(potionNames)
                    potionDropdown:SetValue("Choose Potion")
                    devMsg("Selected tier: " .. value)
                    break
                end
            end
        end)

        -- Handler ketika potion dipilih
        potionDropdown:OnChanged(function(value)
            if value == "Choose Potion" or not selectedTier then
                selectedPotion = nil
                autoMergeToggle:SetValue(false)
                devMsg("Potion selection cleared")
                return
            end

            -- Cari potion yang dipilih
            for _, potion in ipairs(selectedTier.Items) do
                if potion.Name == value then
                    selectedPotion = potion
                    devMsg("Selected potion: " .. value .. " (" ..
                               potion.Description .. ")")
                    break
                end
            end
        end)

        -- Function untuk auto merge
        function startAutoMerge()
            if not autoMergeEnabled or not selectedPotion then return end

            while autoMergeEnabled and selectedPotion do
                SafeRemoteInvoke("PotionMerge",
                                 {["id"] = selectedPotion.Id, ["count"] = 5})

                devMsg(
                    "üîÑ Merging: " .. selectedPotion.Name .. " x5 (Delay: " ..
                        mergeDelay .. "s)")
                task.wait(mergeDelay) -- Pakai delay dari slider
            end
        end
        -- ** End:PotionMerge

        -- ** Player:MachineEquip
        Tabs.Premium:AddSection("Machine Equip")

        -- Dropdown untuk memilih machine
        local MachineDropdown = Tabs.Premium:AddDropdown("MachineDropdown", {
            Title = "Machine",
            Values = {
                "Choose Machine", "Mask", "Awakening", "Ornament", "Breath",
                "Talisman", "Headdress", "Elemental"
            },
            Multi = false,
            Default = "Choose Machine"
        })

        -- Dropdown untuk equipment (akan diupdate berdasarkan machine yang dipilih)
        local EquipmentDropdown = Tabs.Premium:AddDropdown("EquipmentDropdown",
                                                           {
            Title = "Equipment",
            Values = {"Choose equipment first"},
            Multi = false,
            Default = "Choose equipment first"
        })

        -- Variable untuk menyimpan machine yang aktif
        local currentMachine = nil

        -- Handler ketika machine dipilih
        MachineDropdown:OnChanged(function(selectedMachine)
            if selectedMachine == "Choose Machine" then
                EquipmentDropdown:SetValues({"Choose equipment first"})
                EquipmentDropdown:SetValue("Choose equipment first")
                currentMachine = nil
                return
            end

            -- Cari data machine yang dipilih
            for _, machineData in ipairs(AlienshopData) do
                if machineData.MachineName == selectedMachine then
                    currentMachine = machineData

                    -- Update equipment dropdown
                    local equipmentNames = {"Choose Equipment"}
                    for _, item in ipairs(machineData.Items) do
                        table.insert(equipmentNames, item.Name)
                    end

                    EquipmentDropdown:SetValues(equipmentNames)
                    EquipmentDropdown:SetValue("Choose Equipment")
                    devMsg("Loaded: " .. selectedMachine .. " (" ..
                               #machineData.Items .. " items)")
                    break
                end
            end
        end)

        -- Handler ketika equipment dipilih
        EquipmentDropdown:OnChanged(function(selectedEquipment)
            if not currentMachine or selectedEquipment == "Choose Equipment" then
                return
            end

            -- Cari item yang dipilih
            for _, item in ipairs(currentMachine.Items) do
                if item.Name == selectedEquipment then
                    SafeRemoteInvoke("UseOrnament", {
                        ["isEquip"] = true,
                        ["ornamentId"] = item.Id,
                        ["machineId"] = currentMachine.MachineId
                    })
                    devMsg("Equipped: " .. selectedEquipment .. " from " ..
                               currentMachine.MachineName)
                    break
                end
            end
        end)

        -- ** Premium:Start:Server
        Tabs.Premium:AddSection("Server")
        -- ** Server:ServerDropdown **
        local ServerDropdown = Tabs.Premium:AddDropdown("ServerDropdown", {
            Title = "Select Server",
            Values = serverOptions,
            Default = serverOptions[1]
        })
        ServerDropdown:OnChanged(function(Selected)
            if Selected and Selected ~= "No servers found" then
                -- Cek apakah ini benar-benar pilihan user (bukan dari refresh)
                if Selected ~= PreviousSelection then
                    local serverId = serverIdMap[Selected]

                    if serverId then
                        -- Notification
                        warn("Joining Server: " .. Selected)

                        -- Teleport setelah delay kecil
                        task.wait(1)
                        local success, errorMsg = pcall(function()
                            TeleportService:TeleportToPlaceInstance(
                                game.PlaceId, serverId, game.Players.LocalPlayer)
                        end)

                        if not success then
                            warn("Teleport failed: " .. tostring(errorMsg))
                        end
                    end
                end
                PreviousSelection = Selected -- Update previous selection
            end
        end)

        -- ** Server:RefreshServer **
        local RefreshServerBtn = Tabs.Premium:AddButton({
            Title = "Refresh Server List",
            Callback = function()
                local newServers = GetActiveServers()

                -- ** Update options **
                local newOptions = {}
                serverIdMap = {}

                for i, server in ipairs(newServers) do
                    local playerStatus = ""
                    -- if server.players >= 2 and server.players <= 3 then
                    --     playerStatus = "‚≠ê "
                    -- elseif server.players == 1 then
                    --     playerStatus = "üü¢ "
                    -- elseif server.players <= 5 then
                    --     playerStatus = "üü° "
                    -- else
                    --     playerStatus = "üî¥ "
                    -- end

                    -- Hanya tampilkan player count
                    local optionText = string.format("%s%d/%d Players",
                                                     playerStatus,
                                                     server.players,
                                                     server.maxPlayers)
                    table.insert(newOptions, optionText)
                    serverIdMap[optionText] = server.id
                end

                if #newOptions == 0 then
                    table.insert(newOptions, "No servers found")
                end

                -- ** Update dropdown tanpa trigger callback teleport **
                PreviousSelection = newOptions[1] -- Set previous selection dulu
                Options.ServerDropdown:SetValues(newOptions)
                Options.ServerDropdown:SetValue(newOptions[1])

                -- Update server info labels
                local newTwoThreeCount = 0
                for i, server in ipairs(newServers) do
                    if server.players >= 2 and server.players <= 3 then
                        newTwoThreeCount = newTwoThreeCount + 1
                    end
                end

                warn("Server List Updated - Found " .. #newServers ..
                         " active servers (" .. newTwoThreeCount ..
                         " with 2-3 players)")
            end
        })

        -- ** Server:InfoServer
        Tabs.Premium:AddParagraph({
            Title = "Server Info",
            Content = "Total Servers: " .. #activeServers ..
                "\n Current Players: " .. #game.Players:GetPlayers()
        })
        -- ** Premium:End:Server

        -- ** Premium:Start:AutoExchangeHalo
        Tabs.Premium:AddSection("Exchange Halo")
        local function TurnOfOtherToggleExchangeHalo(currentToggle)
            local otherToggles = {
                "ToggleAutoExchangeHaloSilver", "ToggleAutoExchangeHaloGold",
                "ToggleAutoExchangeHaloDiamond"
            }

            for _, toggleName in ipairs(otherToggles) do
                if toggleName ~= currentToggle and Options[toggleName] then
                    Options[toggleName]:SetValue(false)
                end
            end
        end
        local ExchangeHaloType = {Silver = 1, Gold = 2, Diamond = 3}
        local ExchangeHaloOrder = {"Silver", "Gold", "Diamond"}
        for _, haloName in ipairs(ExchangeHaloOrder) do
            local ExchangeHaloId = ExchangeHaloType[haloName]
            local toggleName = "ToggleAutoExchangeHalo" .. haloName
            local toggle = Tabs.Premium:AddToggle(toggleName, {
                Title = "Halo " .. haloName,
                Default = false,
                Callback = function(value)
                    if value then
                        -- Matikan toggle lain
                        TurnOfOtherToggleExchangeHalo(toggleName)
                        -- Jalankan loop otomatis
                        task.spawn(function()
                            while Options[toggleName].Value do
                                SafeRemoteInvoke("ExchangeHaloDrawItem", {
                                    ["haloType"] = ExchangeHaloId,
                                    ["count"] = 1
                                })
                                task.wait(Options.AutoExchangeHaloDelay)
                            end
                        end)
                    else
                        devMsg("Halo " .. haloName .. " stopped")
                    end
                end
            })
        end
        -- ** EggSpin:AutoExchangeHaloDelay
        local AutoExchangeHaloDelay = Tabs.Premium:AddSlider(
                                          "AutoExchangeHaloDelay", {
                Title = "Delay",
                Default = 0.5,
                Min = 0.1,
                Max = 5,
                Rounding = 1,
                Callback = function(value)
                    Options.AutoExchangeHaloDelay = value
                end
            })
        Options.AutoExchangeHaloDelay:SetValue(0.5)
        -- ** Premium:End:AutoExchangeHalo

        -- ** Premium:AntiqueDelay
        Tabs.Premium:AddSection("Auto Exchange Antique")
        local AntiqueDelay = Tabs.Premium:AddSlider("AntiqueDelay", {
            Title = "Delay",
            Default = 0.5,
            Min = 0.1,
            Max = 5,
            Rounding = 1,
            Callback = function(value) Options.AntiqueDelay = value end
        })
        Options.AntiqueDelay:SetValue(0.5)
        -- ** Antique:ExchangeAntique
        local AutoExchangeAntique
        local ToggleAutoExchangeAntique =
            Tabs.Premium:AddToggle("ToggleAutoExchangeAntique",
                                   {Title = "Auto Exchange", Default = false})
        ToggleAutoExchangeAntique:OnChanged(function(value)
            if value then
                -- Start coroutine
                AutoExchangeAntique = coroutine.create(function()
                    while Options.ToggleAutoExchangeAntique.Value do
                        SafeRemoteCall("ExchangeAntiqueBox", 820001)
                        task.wait(Options.AntiqueDelay)
                    end
                end)
                coroutine.resume(AutoExchangeAntique)
            else
                -- Auto berhenti karena while loop cek Value
                devMsg("Stopped auto power")
            end
        end)
        -- ** Premium:End:ToggleAutoExchangeAntique

    end
    -- ** End:Premium

    -- ** Start:Event
    -- ** Event:ShowSystemMessage
    local ShowSystemMessage = ReplicatedStorage.Remotes:FindFirstChild(
                                  "ShowSystemMessage")
    if ShowSystemMessage and ShowSystemMessage:IsA("RemoteEvent") then
        ShowSystemMessage.OnClientEvent:Connect(function(data)
            local message = tostring(data)

            -- Handle dengan coroutine agar tidak blocking
            coroutine.wrap(function()
                -- ** Premium:Event
                if isPremiumUser() then
                    -- ** Jika Toggle Auto Shadow And Dungeon on
                    if Options.ToggleAutoShadowAndDungeon.Value then
                        HandleAutoShadowAndDungeon(message, false)
                        return
                    end
                end

                local mapListData = {
                    {
                        name = "Dungeon",
                        mapId = 50016,
                        keywords = {
                            "Dungeon unlocked", "you can Enter it in map"
                        },
                        toggle = Options.ToggleAutoDungeon
                    }, {
                        name = "Tower",
                        mapId = 50107,
                        keywords = {
                            "TowerDefense unlocked", "you can Enter it in map"
                        },
                        toggle = Options.ToggleAutoTower
                    }, {
                        name = "Relic",
                        mapId = 50900,
                        keywords = {
                            "Relic Boss unlocked", "you can Enter it in map"
                        },
                        toggle = Options.ToggleAutoRelic
                    }
                }

                -- Cek setiap map type
                for _, mapData in ipairs(mapListData) do
                    -- ‚úÖ CEK TOGGLE DULU - hanya proses yang toggle NYALA
                    if mapData.toggle and mapData.toggle.Value then
                        for _, keyword in ipairs(mapData.keywords) do
                            if string.find(message:lower(), keyword:lower()) then
                                warn("üéØ Auto teleport to " .. mapData.name ..
                                         " event...")

                                -- Langsung teleport ke map event
                                SafeRemoteCall("LocalPlayerTeleport",
                                               {["mapId"] = mapData.mapId})

                                warn("‚úÖ Success teleport to " .. mapData.name)
                                return
                            end
                        end
                    end
                end
            end)()
        end)
    end

    -- ** Event:UpdateCityRaidInfo
    local UpdateCityRaidInfo = ReplicatedStorage.Remotes:FindFirstChild(
                                   "UpdateCityRaidInfo")
    if UpdateCityRaidInfo and UpdateCityRaidInfo:IsA("RemoteEvent") then
        UpdateCityRaidInfo.OnClientEvent:Connect(function(data)
            if data and type(data) == "table" and data.action then
                devMsg("UpdateCityRaidInfo : " .. data.action)
                if isPremiumUser() then
                    if Options.ToggleAutoShadowCityRaidAndOctopus.Value then
                        HandleAutoShadowCityRaidAndOctopus(data.action, false)
                        return
                    end
                end
            end
        end)
    end

    -- ** Event:RefreshSuperBoss
    local RefreshSuperBoss = ReplicatedStorage.Remotes:FindFirstChild(
                                 "RefreshSuperBoss")
    if RefreshSuperBoss and RefreshSuperBoss:IsA("RemoteEvent") then
        RefreshSuperBoss.OnClientEvent:Connect(function(data)
            if data and type(data) == "table" then
                if Options.ToggleAutoShadow.Value then
                    HandleAutoShadow(data.mapId, true)
                    return
                end

                if isPremiumUser() then
                    if Options.ToggleAutoShadowAndDungeon.Value then
                        HandleAutoShadowAndDungeon(data.mapId, true)
                        return
                    end

                    if Options.ToggleAutoShadowCityRaidAndOctopus.Value then
                        HandleAutoShadowCityRaidAndOctopus(data.mapId, true)
                        return
                    end
                end
            end
        end)
    end

    -- ** Event:UpdateSpawnMap (Teleport dapet data map nya)
    -- local UpdateSpawnMap = ReplicatedStorage.Remotes:FindFirstChild(
    --                            "UpdateSpawnMap")
    -- if UpdateSpawnMap and UpdateSpawnMap:IsA("RemoteEvent") then
    --     UpdateSpawnMap.OnClientEvent:Connect(function(data)
    --         print("UpdateSpawnMap")
    --         print(data)
    --     end)
    -- end

end

-- ** End:Main

-- Addons:
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})
InterfaceManager:SetFolder(folderName)
SaveManager:SetFolder(folderName .. "/config")
InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)

Window:SelectTab(1)

Fluent:Notify({
    Title = Title,
    Content = "The script has been loaded.",
    Duration = 3
})

-- You can use the SaveManager:LoadAutoloadConfig() to load a config
-- which has been marked to be one that auto loads!
SaveManager:LoadAutoloadConfig()
